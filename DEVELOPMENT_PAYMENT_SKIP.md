# 开发环境跳过支付功能使用指南

## 功能说明

在开发环境中，你现在可以跳过支付流程直接访问详细报告页面，这样便于开发和测试详细报告功能。**重要**：解锁详细报告的按钮仍然会显示，让你可以测试完整的用户体验流程。

## 使用方法

### 1. 创建开发环境配置

创建 `.env.development` 文件并添加以下配置：

```env
# 开发环境专用功能
VITE_SKIP_PAYMENT_IN_DEV=true

# 其他开发配置
VITE_ENABLE_DEBUG_MODE=true
VITE_ENABLE_DEV_TOOLS=true
VITE_ENABLE_CONSOLE_LOGGING=true
```

### 2. 启动开发服务器

```bash
npm run dev
```

### 3. 测试流程

1. 访问主页，开始测评
2. 完成36道题目的ECR测评
3. 查看基础报告页面
4. 点击"解锁详细报告"按钮 ✅ **现在会正常显示！**
5. **无需支付** - 系统会跳过支付页面直接跳转到详细报告
6. 进入详细报告页面，测试PDF导出和分享功能

### 4. 验证功能

在开发环境中，你应该能看到以下控制台日志：
```
🔧 开发环境：显示解锁按钮以便测试完整支付流程
🔧 开发环境：跳过支付流程，直接跳转到详细报告页面
🔧 开发环境：跳过支付检查，直接允许访问详细报告
```

**注意**: 如果看到跳转到404页面或路由错误，请确认：
1. `src/views/ReportView.vue` 第149行正确导入：`import { useRoute, useRouter } from 'vue-router'`
2. 第161行正确使用：`const router = useRouter()`
3. 第313行使用正确的路由路径：`router.push(\`/report/\${assessmentId.value}/detailed\`)`

路由路径说明：
- 基础报告：`/report/{id}`
- 详细报告：`/report/{id}/detailed`

## 修复的问题

### 问题描述
之前在开发环境启用跳过支付功能时，"解锁详细报告"的整个模块都被隐藏了，导致无法测试完整的用户流程。

### 解决方案
1. **UI显示逻辑分离**：创建了`shouldShowUnlockButton`计算属性，专门控制解锁按钮的显示
2. **跳转逻辑优化**：在`handleUnlock`方法中添加开发环境判断，直接跳转到详细报告页面
3. **双重保护**：既能在详细报告页面跳过权限检查，又能在基础报告页面正常显示解锁按钮

### 技术实现

#### 环境变量配置
- `VITE_SKIP_PAYMENT_IN_DEV=true`: 启用开发环境跳过支付功能
- 仅在 `import.meta.env.DEV === true` 时生效
- 生产环境会自动忽略此配置

#### 代码位置
1. **支付权限检查**：`src/services.ts` 的 `checkPaymentStatus()` 方法
2. **UI显示控制**：`src/views/ReportView.vue` 的 `shouldShowUnlockButton` 计算属性
3. **跳转逻辑**：`src/views/ReportView.vue` 的 `handleUnlock()` 方法

#### 用户体验流程
```
基础报告页面 → 显示解锁按钮 → 点击解锁 → 跳过支付 → 直接进入详细报告
     ↑              ↑              ↑         ↑            ↑
   正常显示      开发环境仍显示    正常点击    跳过Stripe   成功访问
```

## 安全性

- 此功能只在开发环境（`import.meta.env.DEV`）中生效
- 生产环境构建会忽略此配置
- 不会影响生产环境的支付流程
- 提供完整的开发测试体验

## 测试详细报告功能

现在你可以方便地测试：

1. **完整用户流程**
   - 基础报告页面正常显示
   - 解锁按钮正常显示和点击
   - 跳过支付直接进入详细报告

2. **PDF导出功能**
   - 点击"导出PDF"按钮
   - 验证PDF生成和下载
   - 检查PDF内容完整性

3. **分享功能**
   - 点击"分享报告"按钮
   - 测试原生分享API
   - 验证链接复制功能

4. **报告内容展示**
   - 验证所有图表正常显示
   - 检查数据计算准确性
   - 测试响应式布局

## 恢复正常支付流程

要恢复正常的支付检查，只需要：

1. 将 `VITE_SKIP_PAYMENT_IN_DEV` 设置为 `false`
2. 或者删除该环境变量
3. 重启开发服务器

## 注意事项

- 此功能仅用于开发和测试
- 不要在生产环境启用此功能
- 建议在提交代码前测试完整的支付流程
- 解锁按钮会正常显示，提供完整的用户体验测试