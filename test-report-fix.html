<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŠ¥å‘Šé¡µé¢æµ‹è¯•è„šæœ¬</title>
    <style>
        body {
            font-family: 'PingFang SC', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .script-section {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .script-title {
            font-weight: bold;
            color: #495057;
            margin-bottom: 10px;
        }
        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 14px;
            line-height: 1.5;
            overflow-x: auto;
        }
        .instructions {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin: 15px 0;
        }
        .warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
        }
        .success {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 15px 0;
        }
        .button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        .button:hover {
            background: #0056b3;
        }
        .step {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
        }
        .step-number {
            background: #007bff;
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ ECRæŠ¥å‘Šé¡µé¢æµ‹è¯•è„šæœ¬</h1>
        
        <div class="instructions">
            <strong>ğŸ“‹ ä½¿ç”¨è¯´æ˜ï¼š</strong><br>
            1. ç¡®ä¿å¼€å‘æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:5173<br>
            2. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…· (F12)<br>
            3. åˆ‡æ¢åˆ° Console æ ‡ç­¾<br>
            4. å¤åˆ¶å¹¶æ‰§è¡Œä¸‹é¢çš„è„šæœ¬
        </div>

        <div class="step">
            <div class="script-title">
                <span class="step-number">1</span>
                åˆ›å»ºæµ‹è¯„å¹¶å¿«é€Ÿå®Œæˆ
            </div>
            <div class="code-block">
// å¯¼å…¥store
const { useAppStore } = await import('/src/store.ts')
const store = useAppStore()

// åˆ›å»ºæ–°æµ‹è¯„
console.log('ğŸš€ åˆ›å»ºæ–°æµ‹è¯„...')
const assessmentId = await store.createNewAssessment()
console.log('âœ… æµ‹è¯„åˆ›å»ºæˆåŠŸï¼ŒID:', assessmentId)

// å¿«é€Ÿå®Œæˆæµ‹è¯„ï¼ˆå®‰å…¨å‹ï¼‰
console.log('âš¡ å¿«é€Ÿå®Œæˆæµ‹è¯„...')
await store.quickCompleteAssessment('secure')
console.log('âœ… æµ‹è¯„å®Œæˆï¼')

// æ£€æŸ¥æ•°æ®
console.log('ğŸ“Š æ£€æŸ¥æµ‹è¯„æ•°æ®:', store.currentAssessment)
console.log('ğŸ“ˆ æ£€æŸ¥ç»“æœæ•°æ®:', store.currentAssessment?.result)
            </div>
        </div>

        <div class="step">
            <div class="script-title">
                <span class="step-number">2</span>
                è·³è½¬åˆ°æŠ¥å‘Šé¡µé¢
            </div>
            <div class="code-block">
// è·³è½¬åˆ°åŸºç¡€æŠ¥å‘Šé¡µé¢
const reportUrl = `/report/${assessmentId}`
console.log('ğŸ”— è·³è½¬åˆ°æŠ¥å‘Šé¡µé¢:', reportUrl)
window.location.href = reportUrl
            </div>
        </div>

        <div class="warning">
            <strong>âš ï¸ å¦‚æœä»ç„¶çœ‹åˆ°"æµ‹è¯„å°šæœªå®Œæˆ"é”™è¯¯ï¼š</strong><br>
            è¯·åœ¨æ§åˆ¶å°ä¸­è¿è¡Œè°ƒè¯•è„šæœ¬æ£€æŸ¥æ•°æ®çŠ¶æ€
        </div>

        <div class="step">
            <div class="script-title">
                <span class="step-number">3</span>
                è°ƒè¯•è„šæœ¬ï¼ˆå¦‚æœæŠ¥å‘Šé¡µé¢ä»æœ‰é—®é¢˜ï¼‰
            </div>
            <div class="code-block">
// è°ƒè¯•å½“å‰çŠ¶æ€
console.log('=== è°ƒè¯•ä¿¡æ¯ ===')
console.log('Current URL:', window.location.href)
console.log('Assessment ID from URL:', window.location.pathname.split('/')[2])

// é‡æ–°è·å–store
const { useAppStore } = await import('/src/store.ts')
const store = useAppStore()

console.log('Store assessment:', store.currentAssessment)
console.log('Has assessment:', !!store.currentAssessment)
console.log('Assessment result:', store.currentAssessment?.result)
console.log('Assessment basicResult:', store.currentAssessment?.basicResult)

// å¦‚æœæ²¡æœ‰æ•°æ®ï¼Œå°è¯•åŠ è½½
const urlAssessmentId = window.location.pathname.split('/')[2]
if (urlAssessmentId && (!store.currentAssessment || store.currentAssessment.id !== urlAssessmentId)) {
    console.log('ğŸ”„ å°è¯•åŠ è½½æµ‹è¯„æ•°æ®...')
    const success = await store.loadAssessment(urlAssessmentId)
    console.log('åŠ è½½ç»“æœ:', success)
    console.log('åŠ è½½åçš„æ•°æ®:', store.currentAssessment)
}
            </div>
        </div>

        <div class="step">
            <div class="script-title">
                <span class="step-number">4</span>
                å¿«é€Ÿæµ‹è¯•ä¸åŒä¾æ‹ç±»å‹
            </div>
            <div class="code-block">
// æµ‹è¯•ä¸åŒä¾æ‹ç±»å‹
const testTypes = ['secure', 'anxious', 'avoidant', 'disorganized']

for (const type of testTypes) {
    console.log(`ğŸ§ª æµ‹è¯• ${type} ç±»å‹...`)
    
    // åˆ›å»ºæ–°æµ‹è¯„
    const id = await store.createNewAssessment()
    await store.quickCompleteAssessment(type)
    
    console.log(`âœ… ${type} ç±»å‹æµ‹è¯„å®Œæˆ`)
    console.log(`ğŸ“Š ç»“æœ:`, store.currentAssessment?.result)
    
    // è·³è½¬åˆ°æŠ¥å‘Šé¡µé¢è¿›è¡ŒéªŒè¯
    console.log(`ğŸ”— è®¿é—®æŠ¥å‘Š: /report/${id}`)
}
            </div>
        </div>

        <div class="success">
            <strong>âœ… é¢„æœŸç»“æœï¼š</strong><br>
            1. èƒ½å¤ŸæˆåŠŸåˆ›å»ºå’Œå®Œæˆæµ‹è¯„<br>
            2. æŠ¥å‘Šé¡µé¢æ˜¾ç¤ºæ­£ç¡®çš„ä¾æ‹ç±»å‹å’Œåˆ†æ•°<br>
            3. åŸºç¡€æŠ¥å‘Šå’Œè¯¦ç»†æŠ¥å‘Šéƒ½èƒ½æ­£å¸¸æ˜¾ç¤º<br>
            4. ä¸å†å‡ºç°"æµ‹è¯„å°šæœªå®Œæˆ"çš„é”™è¯¯
        </div>

        <div class="script-section">
            <div class="script-title">ğŸ¯ ç›´æ¥æµ‹è¯•æŒ‰é’®</div>
            <p>ä½ ä¹Ÿå¯ä»¥ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®æ¥å¿«é€Ÿæ‰§è¡Œæµ‹è¯•ï¼š</p>
            
            <button class="button" onclick="runQuickTest()">ğŸš€ å¿«é€Ÿæµ‹è¯•</button>
            <button class="button" onclick="runFullTest()">ğŸ§ª å®Œæ•´æµ‹è¯•</button>
            <button class="button" onclick="runDebugCheck()">ğŸ” è°ƒè¯•æ£€æŸ¥</button>
            <button class="button" onclick="runAutoTest()">ğŸ¤– è‡ªåŠ¨æµ‹è¯•ä¿®å¤</button>
        </div>
    </div>

    <script>
        async function runQuickTest() {
            try {
                console.log('ğŸš€ å¼€å§‹å¿«é€Ÿæµ‹è¯•...')
                
                const { useAppStore } = await import('/src/store.ts')
                const store = useAppStore()
                
                const assessmentId = await store.createNewAssessment()
                console.log('âœ… æµ‹è¯„åˆ›å»ºæˆåŠŸï¼ŒID:', assessmentId)
                
                await store.quickCompleteAssessment('secure')
                console.log('âœ… æµ‹è¯„å®Œæˆï¼')
                
                window.location.href = `/report/${assessmentId}`
            } catch (error) {
                console.error('âŒ æµ‹è¯•å¤±è´¥:', error)
                alert('æµ‹è¯•å¤±è´¥ï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°')
            }
        }

        async function runFullTest() {
            try {
                console.log('ğŸ§ª å¼€å§‹å®Œæ•´æµ‹è¯•...')
                
                const { useAppStore } = await import('/src/store.ts')
                const store = useAppStore()
                
                const types = ['secure', 'anxious', 'avoidant', 'disorganized']
                
                for (const type of types) {
                    console.log(`ğŸ§ª æµ‹è¯• ${type} ç±»å‹...`)
                    
                    const id = await store.createNewAssessment()
                    await store.quickCompleteAssessment(type)
                    
                    console.log(`âœ… ${type} ç±»å‹æµ‹è¯„å®Œæˆ`)
                    console.log(`ğŸ“Š ç»“æœ:`, store.currentAssessment?.result)
                }
                
                alert('å®Œæ•´æµ‹è¯•å®Œæˆï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—')
            } catch (error) {
                console.error('âŒ æµ‹è¯•å¤±è´¥:', error)
                alert('æµ‹è¯•å¤±è´¥ï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°')
            }
        }

        async function runDebugCheck() {
            try {
                console.log('ğŸ” å¼€å§‹è°ƒè¯•æ£€æŸ¥...')
                
                const { useAppStore } = await import('/src/store.ts')
                const store = useAppStore()
                
                console.log('Store assessment:', store.currentAssessment)
                console.log('Has assessment:', !!store.currentAssessment)
                console.log('Assessment basicResult:', store.currentAssessment?.basicResult)
                
                const urlAssessmentId = window.location.pathname.split('/')[2]
                if (urlAssessmentId) {
                    console.log('URL Assessment ID:', urlAssessmentId)
                    const success = await store.loadAssessment(urlAssessmentId)
                    console.log('Load success:', success)
                }
                
                alert('è°ƒè¯•æ£€æŸ¥å®Œæˆï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—')
            } catch (error) {
                console.error('âŒ è°ƒè¯•å¤±è´¥:', error)
                alert('è°ƒè¯•å¤±è´¥ï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°')
            }
        }

        async function runAutoTest() {
            try {
                console.log('ğŸ¤– å¼€å§‹è‡ªåŠ¨æµ‹è¯•æŠ¥å‘Šé¡µé¢ä¿®å¤...')
                
                const { useAppStore } = await import('/src/store.ts')
                const store = useAppStore()
                
                // åˆ›å»ºæ–°æµ‹è¯„
                console.log('ğŸ“ åˆ›å»ºæ–°æµ‹è¯„...')
                const assessmentId = await store.createNewAssessment()
                console.log('âœ… æµ‹è¯„åˆ›å»ºæˆåŠŸï¼ŒID:', assessmentId)
                
                // å¿«é€Ÿå®Œæˆæµ‹è¯„
                console.log('âš¡ å¿«é€Ÿå®Œæˆæµ‹è¯„ï¼ˆç„¦è™‘å‹ï¼‰...')
                await store.quickCompleteAssessment('anxious')
                console.log('âœ… æµ‹è¯„å®Œæˆï¼')
                
                // æ£€æŸ¥æ•°æ®ç»“æ„
                console.log('ğŸ“Š æ£€æŸ¥æ•°æ®ç»“æ„:')
                console.log('  - currentAssessment:', !!store.currentAssessment)
                console.log('  - has basicResult:', !!store.currentAssessment?.basicResult)
                console.log('  - result data:', store.currentAssessment?.basicResult)
                
                // æ¨¡æ‹ŸæŠ¥å‘Šé¡µé¢æ£€æŸ¥é€»è¾‘
                console.log('ğŸ” æ¨¡æ‹ŸæŠ¥å‘Šé¡µé¢æ£€æŸ¥é€»è¾‘...')
                const assessment = store.currentAssessment
                const hasBasicResult = !!assessment?.basicResult
                
                if (hasBasicResult) {
                    console.log('âœ… æŠ¥å‘Šé¡µé¢åº”è¯¥èƒ½æ­£å¸¸æ˜¾ç¤ºæ•°æ®')
                    
                    // æµ‹è¯•æ•°æ®è½¬æ¢é€»è¾‘
                    const result = assessment?.basicResult
                    const convertedResult = {
                        anxious: result.anxious,
                        avoidant: result.avoidant,
                        attachmentStyle: result.style
                    }
                    console.log('ğŸ“ˆ è½¬æ¢åçš„ç»“æœ:', convertedResult)
                    
                    // è·³è½¬åˆ°æŠ¥å‘Šé¡µé¢éªŒè¯
                    console.log('ğŸ”— è·³è½¬åˆ°æŠ¥å‘Šé¡µé¢è¿›è¡Œæœ€ç»ˆéªŒè¯...')
                    window.location.href = `/report/${assessmentId}`
                    
                } else {
                    console.error('âŒ æ•°æ®æ£€æŸ¥å¤±è´¥ï¼ŒæŠ¥å‘Šé¡µé¢ä»ç„¶ä¼šå‡ºé”™')
                    alert('æ•°æ®æ£€æŸ¥å¤±è´¥ï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°')
                }
                
            } catch (error) {
                console.error('âŒ è‡ªåŠ¨æµ‹è¯•å¤±è´¥:', error)
                alert('è‡ªåŠ¨æµ‹è¯•å¤±è´¥ï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°')
            }
        }
    </script>
</body>
</html> 